<div class="organizations-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="header-left">
            <h1 class="page-title">Organization Management</h1>
            <p class="page-subtitle">Manage NGOs and government organizations</p>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filter by Type</mat-label>
            <mat-select [(ngModel)]="selectedType" (selectionChange)="applyFilters()">
                <mat-option value="all">All Types</mat-option>
                <mat-option value="ngo">NGO</mat-option>
                <mat-option value="government">Government</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filter by Status</mat-label>
            <mat-select [(ngModel)]="selectedStatus" (selectionChange)="applyFilters()">
                <mat-option value="all">All Status</mat-option>
                <mat-option value="approved">Approved</mat-option>
                <mat-option value="pending">Pending</mat-option>
                <mat-option value="disabled">Disabled</mat-option>
            </mat-select>
        </mat-form-field>

        <div class="results-count">
            <span>Showing {{ filteredOrganizations.length }} of {{ organizations.length }} organizations</span>
        </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading-state">
        <mat-icon class="loading-icon">hourglass_empty</mat-icon>
        <p>Loading organizations...</p>
    </div>

    <!-- Organizations Table -->
    <div *ngIf="!loading" class="table-container">
        <table mat-table [dataSource]="filteredOrganizations" class="organizations-table">

            <!-- Name Column -->
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Organization</th>
                <td mat-cell *matCellDef="let org">
                    <div class="org-info">
                        <mat-icon class="org-icon">business</mat-icon>
                        <span class="org-name">{{ org.name }}</span>
                    </div>
                </td>
            </ng-container>

            <!-- Type Column -->
            <ng-container matColumnDef="type">
                <th mat-header-cell *matHeaderCellDef>Type</th>
                <td mat-cell *matCellDef="let org">
                    <mat-chip [color]="getTypeColor(org.type)">
                        {{ org.type | uppercase }}
                    </mat-chip>
                </td>
            </ng-container>

            <!-- Contact Column -->
            <ng-container matColumnDef="contact">
                <th mat-header-cell *matHeaderCellDef>Contact</th>
                <td mat-cell *matCellDef="let org">
                    <div class="contact-info">
                        <div class="contact-item">
                            <mat-icon class="contact-icon">email</mat-icon>
                            <span>{{ org.contact.email }}</span>
                        </div>
                        <div class="contact-item">
                            <mat-icon class="contact-icon">phone</mat-icon>
                            <span>{{ org.contact.phone }}</span>
                        </div>
                    </div>
                </td>
            </ng-container>

            <!-- Capacity Column -->
            <ng-container matColumnDef="capacity">
                <th mat-header-cell *matHeaderCellDef>Capacity</th>
                <td mat-cell *matCellDef="let org">
                    <div class="capacity-info">
                        <div class="capacity-item">
                            <mat-icon class="capacity-icon">people</mat-icon>
                            <span>{{ org.capacity.volunteers }} volunteers</span>
                        </div>
                        <div class="capacity-item">
                            <mat-icon class="capacity-icon">inventory_2</mat-icon>
                            <span>{{ org.capacity.resources.food + org.capacity.resources.medical +
                                org.capacity.resources.shelter }} resources</span>
                        </div>
                    </div>
                </td>
            </ng-container>

            <!-- Workload Column -->
            <ng-container matColumnDef="workload">
                <th mat-header-cell *matHeaderCellDef>Workload</th>
                <td mat-cell *matCellDef="let org">
                    <div class="workload-container">
                        <div class="workload-bar">
                            <div class="workload-fill" [style.width.%]="org.currentWorkload"
                                [style.background-color]="getWorkloadColor(org.currentWorkload)"></div>
                        </div>
                        <span class="workload-text">{{ org.currentWorkload }}%</span>
                    </div>
                </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let org">
                    <mat-chip [color]="getStatusColor(org.status)">
                        <mat-icon class="status-icon">
                            {{ org.status === 'approved' ? 'check_circle' : org.status === 'pending' ? 'schedule' :
                            'block' }}
                        </mat-icon>
                        {{ org.status | uppercase }}
                    </mat-chip>
                </td>
            </ng-container>

            <!-- Registered Date Column -->
            <ng-container matColumnDef="registeredDate">
                <th mat-header-cell *matHeaderCellDef>Registered</th>
                <td mat-cell *matCellDef="let org">{{ formatDate(org.registeredDate) }}</td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let org">
                    <button mat-icon-button [matMenuTriggerFor]="menu">
                        <mat-icon>more_vert</mat-icon>
                    </button>
                    <mat-menu #menu="matMenu">
                        <button mat-menu-item (click)="approveOrganization(org)" [disabled]="org.status === 'approved'"
                            *ngIf="org.status === 'pending'">
                            <mat-icon>check_circle</mat-icon>
                            <span>Approve</span>
                        </button>
                        <button mat-menu-item (click)="rejectOrganization(org)" [disabled]="org.status === 'disabled'"
                            *ngIf="org.status === 'pending'">
                            <mat-icon>cancel</mat-icon>
                            <span>Reject</span>
                        </button>
                        <button mat-menu-item (click)="enableOrganization(org)" *ngIf="org.status === 'disabled'">
                            <mat-icon>check_circle</mat-icon>
                            <span>Enable</span>
                        </button>
                        <button mat-menu-item (click)="disableOrganization(org)" *ngIf="org.status === 'approved'">
                            <mat-icon>block</mat-icon>
                            <span>Disable</span>
                        </button>
                    </mat-menu>
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>

        <!-- Empty State -->
        <div *ngIf="filteredOrganizations.length === 0" class="empty-state">
            <mat-icon>business</mat-icon>
            <p>No organizations found matching your filters</p>
        </div>
    </div>
</div>